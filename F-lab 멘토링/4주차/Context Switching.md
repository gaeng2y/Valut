### Context Switching의 정의

Context Switching은 CPU가 현재 실행 중인 프로세스의 상태(context)를 저장하고, 다음 실행할 프로세스의 상태를 불러오는 작업을 말합니다. 프로세스의 상태에는 프로세서 레지스터, 프로그램 카운터, 스택 포인터 등이 포함됩니다.

### 프로세스 간의 컨텍스트 스위칭

#### 정의
프로세스 간의 컨텍스트 스위칭은 하나의 프로세스에서 다른 프로세스로 CPU 실행을 전환하는 과정입니다.
#### 동작 원리
1. **현재 프로세스 상태 저장**: 현재 실행 중인 프로세스의 레지스터, 프로그램 카운터, 스택 포인터 등의 상태를 프로세스 제어 블록(PCB, Process Control Block)에 저장합니다.
2. **스케줄링**: 스케줄러가 다음 실행할 프로세스를 결정합니다.
3. **상태 복구**: 선택된 프로세스의 상태를 PCB에서 읽어와 레지스터, 프로그램 카운터, 스택 포인터에 복원합니다.
4. **프로세스 실행 재개**: CPU는 복원된 상태에서 프로세스를 실행합니다.
#### 특성
- **오버헤드**: 높은 편입니다. 전체 프로세스의 메모리 공간을 전환해야 하므로 시간이 많이 소요됩니다.
- **주소 공간**: 각 프로세스는 별도의 메모리 주소 공간을 가지므로, 주소 공간 전환이 필요합니다.
- **캐시 미스**: 프로세스 전환 시 캐시가 무효화될 가능성이 높아 캐시 미스가 증가할 수 있습니다.
### 스레드 간의 컨텍스트 스위칭

#### 정의
스레드 간의 컨텍스트 스위칭은 하나의 스레드에서 다른 스레드로 CPU 실행을 전환하는 과정입니다. 같은 프로세스 내의 스레드끼리 전환되는 경우를 말합니다.

#### 동작 원리
1. **현재 스레드 상태 저장**: 현재 실행 중인 스레드의 레지스터, 프로그램 카운터, 스택 포인터 등의 상태를 스레드 제어 블록(TCB, Thread Control Block)에 저장합니다.
2. **스케줄링**: 스레드 스케줄러가 다음 실행할 스레드를 결정합니다.
3. **상태 복구**: 선택된 스레드의 상태를 TCB에서 읽어와 레지스터, 프로그램 카운터, 스택 포인터에 복원합니다.
4. **스레드 실행 재개**: CPU는 복원된 상태에서 스레드를 실행합니다.

#### 특성
- **오버헤드**: 낮은 편입니다. 같은 프로세스 내에서 메모리 주소 공간을 공유하기 때문에 주소 공간 전환이 필요 없습니다.
- **주소 공간**: 동일한 주소 공간을 공유합니다.
- **캐시 미스**: 스레드 간 전환에서는 캐시 미스가 비교적 적습니다. 같은 프로세스의 메모리를 공유하기 때문입니다.

### 비교 요약

|특성|프로세스 간 컨텍스트 스위칭|스레드 간 컨텍스트 스위칭|
|---|---|---|
|**주소 공간 전환**|필요|불필요|
|**오버헤드**|높음|낮음|
|**캐시 미스**|높음|낮음|
|**복잡성**|더 복잡함|덜 복잡함|
|**상태 저장 및 복구**|전체 프로세스 상태(PCB) 저장|스레드 상태(TCB)만 저장|

#### 결론

- **프로세스 간 컨텍스트 스위칭**은 독립적인 주소 공간을 가지는 프로세스 간의 전환이므로 오버헤드가 크고 더 많은 리소스를 소비합니다.
- **스레드 간 컨텍스트 스위칭**은 같은 프로세스 내의 스레드 간 전환이므로 오버헤드가 적고, 주소 공간 전환이 필요 없어서 더 효율적입니다.
### 주의할 점
1. **오버헤드**: Context Switching 자체가 CPU 시간을 소비합니다. 따라서 빈번한 전환은 시스템 성능에 부정적인 영향을 미칠 수 있습니다.
2. **캐시 효율성 저하**: 프로세스 전환 시 캐시 메모리의 내용이 유효하지 않게 되어 캐시 미스(cache miss)가 증가할 수 있습니다.
3. **동기화 문제**: 다중 프로세스 환경에서 데이터 일관성을 유지하기 위해 적절한 동기화 메커니즘이 필요합니다.
4. **스케줄링 알고리즘의 효율성**: 스케줄링 알고리즘이 비효율적이면 특정 프로세스가 지나치게 많은 시간을 대기할 수 있습니다.
5. **실시간 시스템**: 실시간 시스템에서는 Context Switching이 더 큰 문제로 작용할 수 있으며, 정해진 시간 내에 작업을 완료해야 하므로 스위칭 오버헤드가 실시간 요구 사항을 충족하지 못하게 할 수 있습니다.

Context Switching은 멀티태스킹 환경에서 필수적인 기능이지만, 이로 인한 오버헤드와 효율성 문제를 잘 관리해야 시스템 성능을 최적화할 수 있습니다.

### 컨텍스트 스위칭과 CPU 스케줄링의 관계

#### CPU 스케줄링 정의

CPU 스케줄링은 운영체제가 어떤 프로세스나 스레드가 언제 CPU를 사용할지 결정하는 과정입니다. 이는 시스템의 응답 시간, 처리율, 공정성을 최적화하기 위해 필수적입니다.
#### 관계
1. **스케줄링 결정**: CPU 스케줄링 알고리즘은 어떤 프로세스나 스레드가 다음에 실행될지를 결정합니다. 이 결정이 내려지면 컨텍스트 스위칭이 발생합니다.
2. **컨텍스트 스위칭 트리거**: 스케줄러는 인터럽트(타이머 인터럽트, I/O 인터럽트 등), 시스템 호출, 또는 프로세스의 종료와 같은 이벤트에 의해 호출됩니다. 이러한 이벤트는 컨텍스트 스위칭을 트리거합니다.
3. **오버헤드 관리**: 스케줄링 알고리즘의 효율성은 컨텍스트 스위칭의 빈도와 오버헤드에 직접적인 영향을 미칩니다. 빈번한 컨텍스트 스위칭은 CPU 시간을 낭비하고 캐시 효율성을 저하시킬 수 있습니다.
4. **목표 최적화**: 스케줄링 알고리즘은 응답 시간, 처리율, 공정성 등의 목표를 최적화하려고 합니다. 이를 위해 컨텍스트 스위칭의 빈도와 타이밍을 조절합니다. 예를 들어, 선점형 스케줄링은 특정 프로세스가 CPU를 독점하지 못하도록 하기 위해 빈번한 컨텍스트 스위칭을 유도할 수 있습니다.

### 주의할 점
- **오버헤드**: 빈번한 스레드 간 컨텍스트 스위칭은 CPU 오버헤드를 유발할 수 있으며, 이는 전체 시스템 성능에 영향을 미칠 수 있습니다.
- **동기화**: 스레드 간 공유 자원 접근 시 적절한 동기화 메커니즘이 필요합니다. 컨텍스트 스위칭 중 잘못된 동기화는 데이터 일관성 문제를 야기할 수 있습니다.
- **효율성**: 스레드 간 컨텍스트 스위칭은 프로세스 간 스위칭보다 경량이지만, 여전히 시스템 자원을 소모하므로 최소화하는 것이 좋습니다.

스레드 간의 컨텍스트 스위칭과 CPU 스케줄링은 밀접하게 연관되어 있으며, 시스템의 효율적인 멀티태스킹과 자원 관리를 위해 상호작용합니다.